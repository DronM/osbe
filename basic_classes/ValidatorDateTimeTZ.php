<?phprequire_once(FRAME_WORK_PATH.'basic_classes/ValidatorDateTime.php');class ValidatorDateTimeTZ extends ValidatorDateTime {	public function validate($val){		$val = trim($val);		$l = strtolower($val);		if (!$val || !strlen($val) || $l=='undefined' || $l=='null'){			return 'null';		}					$DATE_SEPARATOR = '.';		$TIME_SEPARATOR = ':';				$cor_val = $val;		$cor_val = preg_replace('/\//',$DATE_SEPARATOR,$cor_val);		$cor_val = preg_replace('/-/',$DATE_SEPARATOR,$cor_val);		$cor_val = preg_replace('/_/','',$cor_val);		$cor_val = preg_replace('/T/',' ',$cor_val);				$pos = strpos($cor_val,' ');		if ($pos===FALSE){			//No time part			$part_time = '00:00:00+00:00';			$part_date = $cor_val;					}		else{			$part_time = substr($cor_val,$pos+1);			$part_date = substr($cor_val,0,$pos);		}				$date_parts = explode($DATE_SEPARATOR,$part_date);		if (count($date_parts)<3){			throw new Exception(sprintf(Validator::ER_INVALID_VALUE,'Дата-время'));		}				if (strlen($date_parts[0])==4){			//Year first			list($y,$m,$d) = $date_parts;		}		else{			list($d,$m,$y) = $date_parts;		}		$m = intval($m);		$d = intval($d);		$y = intval($y);				if (strlen($part_date)==8){			//short year						$y+=2000;		}				if (sizeof($date_parts) == 3			&& checkdate($m,$d,$y)){		}		else{			throw new Exception(Validator::ER_INVALID_VALUE);		}				//time dif				$pos = strpos($part_time,'+');		if ($pos===FALSE){			//no time zone			$h_dif = 0;			$min_dif = 0;		}		else{			$part_time_dif = substr($part_time,$pos+1);			$time_parts = explode($TIME_SEPARATOR,$part_time_dif);			if (sizeof($time_parts)>=2){				$h_dif = intval($time_parts[0]);				$min_dif = intval($time_parts[1]);						}			else{				$h_dif = 0;				$min_dif = 0;			}			$part_time = substr($part_time,0,$pos);		}				//time		$time_parts = explode($TIME_SEPARATOR,$part_time);		if (sizeof($time_parts)>=3){			$h = intval($time_parts[0]);			$min = intval($time_parts[1]);			$sec = intval($time_parts[2]);		}		else if (sizeof($time_parts)==2){						$h = intval($time_parts[0]);			$min = intval($time_parts[1]);			$sec = 0;		}		else if (sizeof($time_parts)==1){			$h = intval($time_parts[0]);			$min = 0;			$sec = 0;		}		else{			$h = 0;			$min = 0;			$sec = 0;				}				$d = (($d<10)? '0':'').$d;		$m = (($m<10)? '0':'').$m;		$h = (($h<10)? '0':'').$h;		$min = (($min<10)? '0':'').$min;		$sec = (($sec<10)? '0':'').$sec;				$h_dif = (($h_dif<10)? '0':'').$h_dif;		$min_dif = (($min_dif<10)? '0':'').$min_dif;				//$d_str = .$DATE_SEPARATOR.$m.$DATE_SEPARATOR.$y.' '.$h.':'.$min.':'.$sec.$TIME_DIF_SEPARATOR.$part_time_dif;		$d_str = $y.'-'.$m.'-'.$d.'T'.$h.':'.$min.':'.$sec.'+'.$h_dif.':'.$min_dif;		//throw new Exception($d_str);		//throw new Exception('d='.date('d/m/Y H:i:s',strtotime($d_str)));		return strtotime($d_str);			}		}?>