<?phprequire_once(FRAME_WORK_PATH.'basic_classes/ModelSQL.php');require_once(FRAME_WORK_PATH.'basic_classes/ModelWhereSQL.php');require_once(FRAME_WORK_PATH.'basic_classes/ModelVars.php');class ModelSQLDOC extends ModelSQL{		public function __construct($dbLink,$options=NULL){		parent::__construct($dbLink,$options);	}		public function insert(){		//throw new Exception($this->getInsertQuery(TRUE));		$link = $this->getDbLink();		$link->query('BEGIN');		try{						$ids_ar = $link->query_first($this->getInsertQuery(TRUE));			$link->query(				sprintf("SELECT %s_before_write(%d,%d)",				$this->getTableName(),$_SESSION['LOGIN_ID'],$ids_ar['id'])			);			$link->query(				sprintf("UPDATE %s SET processed=%s WHERE id=%d",				$this->getTableName(),$this->getFieldById('processed')->getValueForDb(),				$ids_ar['id']));			$link->query('COMMIT');		}		catch(Exception $e){			$link->query('ROLLBACK');			throw $e;		}		return $ids_ar['id'];	}		public function update(){		$link = $this->getDbLink();		$link->query('BEGIN');		try{									$link->query(				sprintf("SELECT %s_before_write(%d,%d)",				$this->getTableName(),$_SESSION['LOGIN_ID'],				$this->getFieldById('id')->getOldValue())			);			$q = $this->getUpdateQuery();			//throw new Exception($q);			if ($q!=''){				$link->query($q);			}			$link->query('COMMIT');		}		catch(Exception $e){			$link->query('ROLLBACK');			throw $e;		}	}		}